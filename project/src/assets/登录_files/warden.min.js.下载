!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.warden=e()}(this,function(){"use strict";var t=function(t){return"none"==t.style.display||(!!function(t){if(0==(0,window.getComputedStyle)(t).opacity)return!0;return!1}(t)||(!!function(t){var e=getComputedStyle(t),n=e.clip;if("absolute"===e.position||"fixed"===e.postion){var r=/rect\(([\s\S]+)\)/.exec(n);if(!r||!r[1])return!1;var o=r[1],i=o.split(" ");if(parseInt(i[0])>=parseInt(i[2])||parseInt(i[1])<=parseInt(i[3]))return!0}return!1}(t)||!(!function(t){var e=t.getBoundingClientRect(),n=e.left,r=e.top,o=e.right,i=e.bottom,a=void 0,c=void 0;if(c=window.innerWidth,a=window.innerHeight,o<0)return!0;if(i<0)return!0;if(n>c)return!0;if(r>a)return!0;return!1}(t)||function(t){return"html"==t.nodeName.toLocaleLowerCase()}(t)||function(t){return"body"==t.nodeName.toLocaleLowerCase()}(t))))};var e=function(t,e){return{left:Math.max(t.left,e.left),right:Math.min(t.right,e.right),top:Math.max(t.top,e.top),bottom:Math.min(t.bottom,e.bottom)}},n=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=function(){var t={left:0,top:0,right:window.innerWidth,height:window.innerHeight},e=Object.create(null);return e.basicRect=t,e.sharpRect=t,e}(),o=window.getComputedStyle,i=t.getBoundingClientRect(),a=o(t).position,c=o(t).overflow;return"fixed"==a?r:(n&&(r.basicRect=n.basicRect,r.sharpRect=n.sharpRect),"visible"==c?"absolute"==a&&(r.basicRect=r.sharpRect):"static"==a?r.basicRect=e(r.basicRect,i):"relative"==a?(r.sharpRect=e(r.basicRect,i),r.basicRect=e(r.sharpRect,r.basicRect)):(r.sharpRect=e(r.sharpRect,i),r.basicRect=r.sharpRect),r)};function r(o){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments[2];return(o.ELEMENT_NODE==o.nodeType||o.TEXT_NODE==o.nodeType)&&(o.TEXT_NODE==o.nodeType?function(t,n){if(!t.data)return!1;if(null==t.data.match(/\S/))return!1;if("hidden"==(0,window.getComputedStyle)(t.parentElement).visibility)return!1;var r=t.parentElement.getBoundingClientRect(),o=e(n.basicRect,r),i=o.left,a=o.top,c=o.right,l=o.bottom;return!(i>=c||a>=l)}(o,a):!(!o.innerText&&1==i)&&(!t(o)&&("img"==o.nodeName.toLowerCase()&&2==i?function(t,n){if(!t.src)return!1;if("hidden"==(0,window.getComputedStyle)(t).visibility)return!1;var r=t.getBoundingClientRect(),o=e(n.basicRect,r),i=o.left,a=o.top,c=o.right,l=o.bottom;return!(i>=c||a>=l)}(o,a):function(t,e,o){for(var i=n(t,o),a=t.childNodes,c=a.length,l=0;l<c;l++){var d=r(a[l],e,i);if(d)return!0}return!1}(o,i,a))))}function o(){return!!window.Owl&&(Owl.addError instanceof Function||(console.warn("没有引入cat"),!1))}var i=function(){var t=function(){Object.create(null);return{left:0,top:0,right:window.innerWidth,bottom:window.innerHeight}}(),n=document.getElementsByTagName("html")[0],r=document.getElementsByTagName("body")[0],o=window.getComputedStyle,i=Object.create(null);if(i.sharpRect=t,i.basicRect=i.sharpRect,"visible"!=o(n).overflow&&"visible"!=o(r).overflow){var a=r.getBoundingClientRect();i.basicRect=e(a,i.sharpRect)}return i},a={};function c(t,e){a[t]={value:e,ctime:(new Date).getTime()}}function l(r){if("html"==r.nodeName.toLocaleLowerCase()||"body"==r.nodeName.toLocaleLowerCase())return console.warn("请不要将data-rye设置在body或者html上"),!0;var o=function(t){var e=[],n=t;for(;n;)e.unshift(n),n=n.parentElement;return e}(r);o.pop();var a=o.shift(),c=o.shift();if(t(a)||t(c))return!1;for(var l=i(),d=0;d<o.length;d++){if(t(o[d]))return!1;l=n(o[d],l)}return!t(r)&&function(t,n){if("hidden"==(0,window.getComputedStyle)(t).visibility)return!1;var r=t.getBoundingClientRect(),o=e(n.basicRect,r),i=o.left,a=o.top,c=o.right,l=o.bottom;return!(i>=c||a>=l)}(r,l)}function d(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=function(t){return document.querySelectorAll('[key-dom="'+t+'"]')}(t);if(!n||!n.length)return!1;var r=0;if(e==1/0)for(var o=0;o<n.length;o++){if(!l(n[o]))return!1}else for(var i=0;i<n.length;i++){if(l(n[i])&&++r>=e)return!0}return!1}function u(t){var e=t.target||t.srcElement;if(e){var n=e.nodeName;if(n){if("script"==(n=n.toLocaleLowerCase())){if(null===e.getAttribute("key-script"))return;!function(t){if(o()){var e=(t.target||t.srcElement).src;Owl.addError({name:"keyScriptError",msg:e})}}(t)}if("link"==n){if(null===e.getAttribute("key-css"))return;!function(t){if(o()){var e=(t.target||t.srcElement).href;Owl.addError({name:"keyCssError",msg:e})}}(t)}}}}var s=function(){return window.globalParam&&window.globalParam.t0?globalParam.t0:this.__t0?this.__t0:window.performance&&window.performance.timing?window.performance.timing.navigationStart:void 0},f=function(){return this.tempFCPStampOfServer-s.call(this)},p=function(){var t=this.tempFCPStampOfFrontEnd;if(document.querySelectorAll("[key-script]").length<1)return t-s.call(this);var e=m.call(this),n=0;return this.__t0&&(n=this.__t0-window.performance.timing.navigationStart),e>n?e-n:1},m=function(){var t=[].slice.call(document.querySelectorAll("[key-script]")),e=[].slice.call(document.querySelectorAll("[key-css]")),n=window.performance.getEntriesByType("resource").filter(function(t){return"img"!==t.initiatorType&&"xmlhttprequest"!==t.initiatorType}).sort(function(t,e){return e.responseEnd-t.responseEnd}),r=n.filter(function(n){var r=t.find(function(t){return t.src===n.name});return r=r||e.find(function(t){return t.href===n.name})});return r.length<1?n.length>0?n[0].responseEnd:0:(r=r.sort(function(t,e){return e.responseEnd-t.responseEnd}))[0].responseEnd};function w(t){var e=t.cat1,n=void 0===e?"default":e,r=t.cat2,i=void 0===r?"default":r,a=t.cat3,c=void 0===a?"default":a,l=t.level,d=void 0===l?"info":l,u=t.info,s=void 0===u?"":u,f=t.category,p=void 0===f?"wardenCustom":f,m=t.msg,w=void 0===m?"":m,v=!!o()&&Owl.cfgManager._config,h=v&&v.project||"warden";s instanceof Object&&(s=JSON.stringify(s));var g="tracer_type,"+encodeURIComponent(n)+"|error_level_sub,"+encodeURIComponent(i)+"|error_code,"+encodeURIComponent(c)+"|level,"+encodeURIComponent(d)+"|content,"+encodeURIComponent(s),y=[{msg:w,project:h,pageUrl:v&&v.pageUrl||window.location.pathname,realUrl:window.location.href,timestamp:Date.now(),category:p,sec_category:"wardenCustom",level:d}];g&&(y[0].content=g),function(t){var e=t.data,n=t.type,r=t.url,o=new XMLHttpRequest,i="c="+encodeURIComponent(JSON.stringify(e));if("GET"==n||"get"==n)e?o.open("GET",r+"?"+e,!0):o.open("GET",r+"?t="+Date.now(),!0),o.send();else if(navigator&&navigator.sendBeacon&&"function"==typeof navigator.sendBeacon){var a=new Blob(["c="+encodeURIComponent(JSON.stringify(e))],{type:"application/x-www-form-urlencoded"});navigator.sendBeacon(r,a)}else o.open("POST",r,!1),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.send(i)}({type:"post",url:Owl.cfgManager.url+"/api/log?v=1",data:y})}var v=function(){var t,e=function(){var t=(this.CONFIG||{}).renderType,e=void 0===t?"frontend":t,n=0;if(this.tempFCPStampByReport)return this.tempFCPStampByReport-s.call(this);switch(e){case"server":n=f.call(this);break;case"frontend":default:n=p.call(this)}return n}.call(this);t=e,o()&&Owl.addPoint({position:25,duration:t})};function h(){try{v.call(warden)}catch(t){console.log(t)}}var g=w;function y(t){w({cat1:t.cat1,cat2:t.cat2,cat3:t.cat3,level:"warden",info:t.info})}function b(t,e,n,r,o){void 0!==t&&void 0!==e&&void 0!==n&&void 0===r?(r=n,n="default"):void 0!==t&&void 0!==e&&void 0===n&&void 0===r?(r=e,e="default",n="default"):void 0!==t&&void 0===e&&void 0===n&&void 0===r&&(r=t,t="default",e="default",n="default"),w({cat1:t,cat2:e,cat3:n,level:o,info:r})}var E=window._MeiTuanWardenObject||"warden",R=window[E]||{};return R.isShow=function(t,e,n){c("keyDom",!0);var r=d(t,e);return r||function(t,e,n){o()&&Owl.addError({name:"keyDomError",msg:t},{tags:{info:n}})}(t,0,n),r},R.isWhite=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;c("whiteScree",!0);var a=document.getElementsByTagName("html")[0],l=document.getElementsByTagName("body")[0];if(t(a)||t(l))return!1;var d=r(l,n,i());return d||function(t){o()&&Owl.addError({name:"whiteScreen",msg:"页面白屏"},{tags:{info:t}})}(e),!d},R.reportKeyError=u,R.pageError=function(t,e){o()&&Owl.addError({name:"pageError",msg:t},{tags:{info:e,refer:document.referrer}})},R.reportT5=function(t){var e,n,r,i=s.call(this),a=this.__t0s=this.__t0s||{};a[i]&&console.warn("多次上报t5,请查看是否在同一页面多次调用warden.finish方法"),a[i]=!0,e=13,n=t-i,o()&&Owl.addPoint(e,n,r)},R.reportCustom=g,R.reportLx=function(t){y({cat1:"lx",cat2:t.cat2,cat3:t.cat3,info:t.info})},R.reportApi=function(t,e,n){y({cat1:"api",cat2:t,cat3:e,info:n})},R.reportWarn=function(t,e,n,r){b(t,e,n,r,"warn")},R.reportInfo=function(t,e,n,r){b(t,e,n,r,"info")},R.reportError=function(t,e,n,r){b(t,e,n,r,"error")},function(){if(window.history){var t=history.pushState.bind(history),e=history.replaceState.bind(history),n=this;history.pushState=function(){h.call(n),n.__t0=(new Date).getTime(),t.apply(void 0,arguments)},history.replaceState=function(){h.call(n),n.__t0=(new Date).getTime(),e.apply(void 0,arguments)},window.addEventListener("popstate",function(){h.call(n),n.__t0=(new Date).getTime()})}}.call(R),function(){var t=this;window.addEventListener("hashchange",function(e){h.call(t),t.__t0=(new Date).getTime()})}.call(R),R.__ready=!0,R.__inits=R.__inits||[],R.__errs=R.__errs||[],R.__inits.forEach(function(t){t instanceof Function&&t(R);var e=document.querySelectorAll("[key-css]").length,n=document.querySelectorAll("[key-script]").length;e>0&&c("keyCss",!0),n>0&&c("keyScript",!0)}),R.__errs.forEach(function(t){u(t)}),window.attachEvent?window.attachEvent("beforeunload",h):window.addEventListener&&window.addEventListener("beforeunload",h,!1),R});
